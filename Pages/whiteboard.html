<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Digital Whiteboard — Morgan</title>
    <link rel="stylesheet" href="../style.css" />
    <style>
        .whiteboard-container {
            max-width: 1200px;
            margin: 20px auto;
            background: #161b22;
            border: 2px solid #30363d;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        #toolbar {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: #0d1117;
            border-bottom: 1px solid #30363d;
            align-items: center;
            flex-wrap: wrap;
        }

        #toolbar label {
            font-size: 0.95rem;
            color: #e6edf3;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #color {
            width: 50px;
            height: 30px;
            border: 2px solid #30363d;
            border-radius: 4px;
            cursor: pointer;
        }

        #size {
            width: 120px;
        }

        canvas {
            width: 100%;
            height: 600px;
            background: #fff;
            cursor: crosshair;
            display: block;
        }

        .btn {
            background: #161b22;
            color: #e6edf3;
            border: 1px solid #30363d;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: background 0.2s ease, border-color 0.2s ease;
        }

        .btn:hover {
            background: #30363d;
            border-color: #58a6ff;
        }

        .btn-danger {
            background: #161b22;
            border-color: #f85149;
            color: #f85149;
        }

        .btn-danger:hover {
            background: #f85149;
            color: #0d1117;
        }

        #status {
            color: #3fb950;
            font-size: 0.9rem;
            font-weight: bold;
        }

        h2 {
            border-left: 4px solid #58a6ff;
            padding-left: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<header>
    <h1>Morgan</h1>
    <nav>
        <a href="../index.html">Home</a>
        <a href="about.html">About</a>
        <a href="skills.html">Skills</a>
        <a href="projects.html">Projects</a>
        <a href="tools.html">Tools & Builds</a>
        <a href="fun.html">Fun</a>
        <a href="contact.html">Contact</a>
    </nav>
</header>

<main>
    <h2>Digital Whiteboard</h2>
    <p>A persistent drawing canvas with auto-save functionality. Your drawings are saved automatically in your browser's local storage.</p>

    <div class="whiteboard-container">
        <div id="toolbar">
            <label>
                Color:
                <input type="color" id="color" value="#000000" />
            </label>
            <label>
                Brush Size:
                <input type="range" id="size" min="1" max="30" value="4" />
                <span id="sizeValue">4px</span>
            </label>
            <button class="btn" id="save">Save Now</button>
            <button class="btn btn-danger" id="clear">Clear Canvas</button>
            <span id="status"></span>
        </div>

        <canvas id="board"></canvas>
    </div>
</main>

<footer>
    © 2025 Morgan — Programmer & Technician
</footer>

  <script>
    const canvas = document.getElementById('board');
    const ctx = canvas.getContext('2d');
    const colorInput = document.getElementById('color');
    const sizeInput = document.getElementById('size');
    const sizeValue = document.getElementById('sizeValue');
    const clearBtn = document.getElementById('clear');
    const saveBtn = document.getElementById('save');
    const statusSpan = document.getElementById('status');

    const STORAGE_KEY = 'persistentWhiteboardCanvas_v1';

    // Update size display
    sizeInput.addEventListener('input', () => {
      sizeValue.textContent = sizeInput.value + 'px';
    });

    function resizeCanvas() {
      const container = canvas.parentElement.parentElement;
      const containerWidth = container.clientWidth - 4; // Account for borders
      
      // Save current drawing
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      
      // Set canvas dimensions
      canvas.width = containerWidth;
      canvas.height = 600;
      
      // Restore drawing
      ctx.putImageData(imageData, 0, 0);
      
      // If there's saved data, load it
      if (!imageData.data.some(pixel => pixel !== 0)) {
        loadCanvas();
      }
    }

    window.addEventListener('resize', resizeCanvas);

    let drawing = false;
    let lastX = 0;
    let lastY = 0;

    function startDrawing(e) {
      drawing = true;
      const { x, y } = getPos(e);
      lastX = x;
      lastY = y;
    }

    function stopDrawing() {
      if (!drawing) return;
      drawing = false;
      saveCanvas();
    }

    function draw(e) {
      if (!drawing) return;
      const { x, y } = getPos(e);

      ctx.strokeStyle = colorInput.value;
      ctx.lineWidth = sizeInput.value;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';

      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.stroke();

      lastX = x;
      lastY = y;
    }

    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      
      // Account for canvas scaling
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      
      return {
        x: (clientX - rect.left) * scaleX,
        y: (clientY - rect.top) * scaleY
      };
    }

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    window.addEventListener('mouseup', stopDrawing);

    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      startDrawing(e);
    }, { passive: false });
    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      draw(e);
    }, { passive: false });
    canvas.addEventListener('touchend', (e) => {
      e.preventDefault();
      stopDrawing(e);
    }, { passive: false });

    function saveCanvas() {
      try {
        const data = canvas.toDataURL('image/png');
        localStorage.setItem(STORAGE_KEY, data);
        statusSpan.textContent = 'Saved ✓';
        setTimeout(() => statusSpan.textContent = '', 1500);
      } catch (err) {
        console.error('Save error:', err);
        statusSpan.textContent = 'Save failed ✗';
      }
    }

    function loadCanvas() {
      const data = localStorage.getItem(STORAGE_KEY);
      if (!data) return;
      const img = new Image();
      img.onload = () => {
        ctx.drawImage(img, 0, 0);
      };
      img.src = data;
    }

    function hardClear() {
      if (!confirm('Clear the entire canvas? This will delete your saved drawing.')) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      saveCanvas();
      statusSpan.textContent = 'Cleared';
    }

    clearBtn.addEventListener('click', hardClear);
    saveBtn.addEventListener('click', () => {
      saveCanvas();
    });

    // Initial sizing
    resizeCanvas();
    // Load saved drawing
    loadCanvas();
  </script>
</body>
</html>